groups:
  - name: Windowsä¸»æœºçŠ¶æ€-ç›‘æ§å‘Šè­¦
    rules:
    - alert: WindowsServerCollectorError
      expr: windows_exporter_collector_success == 0
      for: 1m
      labels:
        severity: critical
        for_time: 1m
      annotations:
        summary: "{{ $labels.instance }} ç›‘æ§ç›®æ ‡å¤±è”"
        description: |-
          ğŸš¨ **ç›‘æ§ç›®æ ‡ä¸å¯è¾¾**
          - å®ä¾‹ï¼š{{- if $labels.hostname }}{{ $labels.hostname }} {{ end }}{{ $labels.instance }}
          - å¯èƒ½åŸå› ï¼šæœåŠ¡å´©æºƒ / ç½‘ç»œä¸­æ–­

    - alert: WindowsServerCpuUsage
      expr: |
        (1 - avg by (instance) (
          rate(windows_cpu_time_total{mode="idle"}[5m])
        )) * 100 > 80
      for: 5m
      labels:
        severity: warning
        for_time: 5m
        threshold: "80%"
      annotations:
        summary: "{{ $labels.instance }} ä¸»æœº CPU è´Ÿè½½é«˜"
        description: |-
          âš ï¸ **CPU è´Ÿè½½æŒç»­é«˜äº 80%**
          - å®ä¾‹ï¼š{{ $labels.instance }}
          - å½“å‰ CPU ä½¿ç”¨ç‡ï¼š{{ printf "%.1f%%" $value }}

    - alert: WindowsServerMemoryUsage
      expr: |
        windows_os_physical_memory_free_bytes < 3 * 1024 * 1024 * 1024
        and
        (windows_os_physical_memory_free_bytes / windows_cs_physical_memory_bytes) * 100 < 20
      for: 2m
      labels:
        severity: warning
        for_time: 2m
        threshold: "20% ä¸” < 3GB"
      annotations:
        summary: "{{ $labels.instance }} ä¸»æœºå†…å­˜ä¸è¶³"
        description: |-
          âš ï¸ **å¯ç”¨å†…å­˜ä½äº 20% ä¸”å°äº 3GB**
          - å®ä¾‹ï¼š{{ $labels.instance }}
          - å½“å‰å†…å­˜å¯ç”¨ï¼š{{ humanize $value }}

    - alert: WindowsServerDiskSpaceUsage
      expr: |
        (
          windows_logical_disk_free_bytes < 20 * 1024 * 1024 * 1024
          and
          (windows_logical_disk_free_bytes / windows_logical_disk_size_bytes * 100) < 20
        )
      for: 2m
      labels:
        severity: critical
        for_time: 2m
        threshold: "20% ä¸” < 20GB"
      annotations:
        summary: "{{ $labels.instance }} ç£ç›˜ç©ºé—´ä¸è¶³"
        description: |-
          ğŸš¨ **ç£ç›˜å‰©ä½™ç©ºé—´å°‘äº 20%ä¸”å‰©ä½™ç©ºé—´ä½äº 20GB**
          - å®ä¾‹ï¼š{{ $labels.instance }}
          - ç£ç›˜å·ï¼š{{ $labels.volume }}
          - å‰©ä½™ç©ºé—´ï¼š{{ humanize $value }}

    - alert: ç½‘ç»œæµå…¥å¸¦å®½è¿‡è½½
      expr: (irate(windows_net_bytes_received_total{nic!~'isatap.*|VPN.*'}[5m])*8 /1000/1000) > 8
      for: 1m
      labels:
        severity: warning
        for_time: 1m
        threshold: "8Mbps"
      annotations:
        summary: "{{ $labels.instance }} æµå…¥ï¼ˆä¸‹è½½ï¼‰ç½‘ç»œå¸¦å®½è¿‡é«˜ï¼"
        description: |-
          âš ï¸ **ç½‘ç»œæµå…¥å¸¦å®½è¿‡è½½**
          - å®ä¾‹ï¼š{{ $labels.instance }}
          - æ¥å£ï¼š{{ $labels.device }}
          - å½“å‰å¸¦å®½å ç”¨ï¼š{{ printf "%.2f Mbps" $value }}

    - alert: ç½‘ç»œæµå‡ºå¸¦å®½è¿‡è½½
      expr: (irate(windows_net_bytes_sent_total{nic!~'isatap.*|VPN.*'}[5m])*8 /1000/1000) > 8
      for: 1m
      labels:
        severity: warning
        for_time: 1m
        threshold: "8Mbps"
      annotations:
        summary: "{{ $labels.instance }} æµå‡ºï¼ˆä¸Šä¼ ï¼‰ç½‘ç»œå¸¦å®½è¿‡é«˜ï¼"
        description: |-
          âš ï¸ **ç½‘ç»œæµå‡ºå¸¦å®½è¿‡è½½**
          - å®ä¾‹ï¼š{{- if $labels.hostname }}{{ $labels.hostname }} {{ end }}{{ $labels.instance }}
          - æ¥å£ï¼š{{ $labels.device }}
          - å½“å‰å¸¦å®½å ç”¨ï¼š{{ printf "%.2f Mbps" $value }}
